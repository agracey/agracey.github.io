<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/eos-icons/dist/css/eos-icons.css">
    <link rel="stylesheet" href="/css/eos-style.css">
    <link rel="stylesheet" href="/css/main.css">

    <title>Cloud Native Developer Tools -- Opentelemetry</title></head>
  <body><aside class="main-menu js-main-menu">
    <div class="mm-navigation-container">
      <header><a class="hide-collapsed" href="https://www.eosdesignsystem.com/"><h1 style="color: white; font-size: large; margin-top:10px;">Dev Tools Roundup</h1></a>
        <div class="mm-navigation-close js-sidebar-toggle"><i class="eos-icons js-sidebar-tooltip js-tooltip" data-placement="bottom" title="">menu</i></div>
      </header>

      <div class="nav-wrap">
        <ul class="menu-togglable no-list-style">
          <li class="menu-item">
            <div class="menu-element">
                <span class="main-collapsed-title">Tool Map</span>
            </div>
            <a class="menu-title js-select-current-parent js-feature-flag" href="/">
                <i class="eos-icons">home</i>
                <span class="menu-title-content">Tool Map</span>
            </a>
          </li>

          
          
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="abstractions-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="abstractions-toggle"><i class="eos-icons">translate</i><span class="menu-title-content">Developer Abstractions</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Developer Abstractions</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/helm/">Helm</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/devspace/">DevSpace</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/backstage/">Backstage</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/skaffold/">Skaffold</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="cloud-based-editors-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="cloud-based-editors-toggle"><i class="eos-icons">namespace</i><span class="menu-title-content">Code Editors</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Code Editors</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/jupyter-notebooks/">Jupyter Notebooks</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/gitlab/">Gitlab</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/code-spaces/">Code Spaces</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/gitpod/">Gitpod</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/atheos/">Atheos</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/code-server/">Code Server</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/eclipse-che/">Eclipse Che</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="container-builds-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="container-builds-toggle"><i class="eos-icons">construction</i><span class="menu-title-content">Container Builds</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Container Builds</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/buildah/">Buildah</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/cloudnative-buildpacks/">Buildpacks</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/kaniko/">Kaniko</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/docker/">Docker</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="debugging-and-observability-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="debugging-and-observability-toggle"><i class="eos-icons">visibility</i><span class="menu-title-content">Debugging And Observability</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Debugging And Observability</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/telepresence/">Telepresence</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/rookout/">Rookout</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/pixie/">Pixie</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/opentelemetry/">Opentelemetry</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="misc-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="misc-toggle"><i class="eos-icons">help</i><span class="menu-title-content">Miscellaneous</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Miscellaneous</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/svc-cat/">Service Catalog</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/inlets/">Inlets</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/openapi/">OpenAPI Specification</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="pipelines-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="pipelines-toggle"><i class="eos-icons">wifi_protected_setup</i><span class="menu-title-content">CI/CD Pipelines</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">CI/CD Pipelines</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/tekton/">Tekton</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/jenkins-x/">Jenkins X</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/drone/">Drone</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/argo/">Argo</a></li>
                
                </ul>
            </li>
          
          <hr />
            <li class="menu-item menu-dropdown">
                <input class="js-dropdown-toggle" id="platforms-toggle" type="checkbox" value="checked">
                <label class="menu-title" for="platforms-toggle"><i class="eos-icons">action_chains</i><span class="menu-title-content">Platforms</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
                <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Platforms</li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/crossplane/">Crossplane</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/kubevela/">KubeVela</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/tsuru/">Tsuru</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/openfaas-cloud/">OpenFaaS Cloud</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/openshift-odo/">OpenShift Odo</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/gitlab-autodevops/">Gitlab AutoDevops</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/waypoint/">Waypoint</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/heroku/">Heroku</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/cto_ai/">CTO.ai</a></li>
                
                </ul>
            </li>
          
          
          
        </ul>
      </div>
    </div>
    <footer class="footer-side-menu">
        <ul class="footer-list">
        <li class="footer-list-item"><a class="footer-link" href="/cookies-policy" data-event-category="Internal link" data-event-action="Cookies policy" data-event-label="Footer">Cookie policy</a></li>
        <li class="footer-list-item"><a class="footer-link" href="https://eosdesignsystem.com/" data-event-category="External link" data-event-action="Link EOS website" data-event-label="Footer" target="_blank" rel="noreferrer nonopener"><img class="js-tooltip" src="/images/eos-logo.svg" data-toggle="tooltip" data-html="true" title="Visit our website" alt="EOS icon"></a></li>
        </ul>
    </footer>
</aside><div class="mobile-menu js-mobile-menu">
    <header><a href="/"><h1 style="color: white; font-size: large; margin-top:10px;">Dev Tools Roundup</h1></a>
        <div class="burger-menu js-burger-menu"><a><i class="eos-icons">menu</i></a></div>
    </header>
    <nav class="display-nav">
        <div class="nav-wrap">
        <ul class="menu-togglable no-list-style">
            <li class="menu-item">
          <div class="menu-element"><span class="main-collapsed-title">Tool Map</span></div><a class="menu-title js-select-current-parent js-feature-flag" href="/"><i class="eos-icons">home</i><span class="menu-title-content">Tool Map</span></a>
          
          
          
          
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">translate</i><span class="menu-title-content">Abstractions</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Developer Abstractions</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/helm/">Helm</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/devspace/">DevSpace</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/backstage/">Backstage</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/abstractions/skaffold/">Skaffold</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">namespace</i><span class="menu-title-content">Cloud based editors</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Code Editors</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/jupyter-notebooks/">Jupyter Notebooks</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/gitlab/">Gitlab</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/code-spaces/">Code Spaces</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/gitpod/">Gitpod</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/atheos/">Atheos</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/code-server/">Code Server</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/cloud-based-editors/eclipse-che/">Eclipse Che</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">construction</i><span class="menu-title-content">Container builds</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Container Builds</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/buildah/">Buildah</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/cloudnative-buildpacks/">Buildpacks</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/kaniko/">Kaniko</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/container-builds/docker/">Docker</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">visibility</i><span class="menu-title-content">Debugging and observability</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Debugging And Observability</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/telepresence/">Telepresence</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/rookout/">Rookout</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/pixie/">Pixie</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/debugging-and-observability/opentelemetry/">Opentelemetry</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">help</i><span class="menu-title-content">Misc</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Miscellaneous</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/svc-cat/">Service Catalog</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/inlets/">Inlets</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/misc/openapi/">OpenAPI Specification</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">wifi_protected_setup</i><span class="menu-title-content">Pipelines</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">CI/CD Pipelines</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/tekton/">Tekton</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/jenkins-x/">Jenkins X</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/drone/">Drone</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/pipelines/argo/">Argo</a></li>
                
            </ul>
          </li>
          
  
          <li class="menu-item menu-dropdown">
            <input class="js-dropdown-toggle" id="documentation-toggle" type="checkbox">
            <label class="menu-title" for="documentation-toggle"><i class="eos-icons">action_chains</i><span class="menu-title-content">Platforms</span><i class="eos-icons eos-18 float-right menu-expand">keyboard_arrow_down</i></label>
            <ul class="menu-dropdown-list menu-element">
                <li class="menu-collapsed-title">Platforms</li>

                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/crossplane/">Crossplane</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/kubevela/">KubeVela</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/tsuru/">Tsuru</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/openfaas-cloud/">OpenFaaS Cloud</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/openshift-odo/">OpenShift Odo</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/gitlab-autodevops/">Gitlab AutoDevops</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/waypoint/">Waypoint</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/heroku/">Heroku</a></li>
                
                  <li><a class="menu-title js-select-current js-feature-flag " href="/reviews/platforms/cto_ai/">CTO.ai</a></li>
                
            </ul>
          </li>
          
          
          
        </ul>
      </div>
    </nav>
  </div><section class="content"><div class="submenu js-submenu-section">

</div><div class="container">
        
  <section class="tool-title">
    <h1>Review of <span>Opentelemetry</span></h1>
    <div class="author">Written Dec 7, 2020 by  -- </div>
  </section><dl class="tool-data pull-right">
    <div class='card'>
      <img class='card-img' src='/icons/opentelemetry.png' alt='SUSE-logo' />
      <div class='card-body'>
        <h6 class='card-subtitle mb-2'>Homepage</h6><p class='card-text'><a href="https://opentelemetry.io">https://opentelemetry.io</a></p>
        <h6 class='card-subtitle mb-2'>Github</h6><p class='card-text'><a href="https://github.com/open-telemetry">https://github.com/open-telemetry</a></p>

        <h6 class='card-subtitle mb-2'>Version Tested</h6><p class='card-text'></p>
        
      </div>
      <h5 class='card-title'>Contents</h5>
      <p class='card-text'>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-observability">What is Observability</a>
      <ul>
        <li><a href="#metrics">Metrics</a></li>
        <li><a href="#logging">Logging</a></li>
        <li><a href="#tracing">Tracing</a></li>
      </ul>
    </li>
    <li><a href="#review">Review</a>
      <ul>
        <li><a href="#prior-knowledge-needed">Prior knowledge needed</a></li>
        <li><a href="#sample-instrumentation">Sample Instrumentation</a>
          <ul>
            <li><a href="#opentelemetry-collector">OpenTelemetry Collector</a></li>
            <li><a href="#zipkin">Zipkin</a></li>
            <li><a href="#prometheus">Prometheus</a></li>
            <li><a href="#application-code">Application Code</a></li>
            <li><a href="#tracing-auto-instrumentation">Tracing Auto Instrumentation</a></li>
            <li><a href="#metrics-collection">Metrics Collection</a></li>
            <li><a href="#logging-1">Logging</a></li>
          </ul>
        </li>
        <li><a href="#pros">Pros</a></li>
        <li><a href="#cons">Cons</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
      </p>
    </div>
  </dl><section class="welcome">
    <p>This is part of a series of <a href="/">cloud native developer tool reviews</a> in which I look at many of the popular or interesting tools for developers building software in a Cloud Native world. </p>
    <p> As many developers have experienced, this new way of developing software can lead to an explosion of process complexity. Using the right tools for the job can help mitigate this significantly. 
      I'm hoping that with these reviews, you can find the toolset that works best for you and the amazing things you are building!</p>

  </section>
  <section class="section-review"></section>


  

  <section class="tool-review"><p>OpenTelemetry is a set of specifications, tools, and best practices for instrumenting code for observability. It was formed by OpenTracing and OpenCensus joining together and donating their work to the CNCF as a sandbox project.</p>
<h1 id="what-is-observability">What is Observability 
    <a href="#what-is-observability" class="heading-link"><i class="eos-icons">link</i></a>
</h1>
<p>Observability is all about exposing the inner structure of how data flows through a system to the people having to maintain the system. This can be exceedingly difficult in cloud native architectures as the data path can be across several components (likely maintained by several teams). When something goes wrong in the system, it&rsquo;s helpful to have ways of looking back at the path data took and the system state as errors occurred.</p>
<h2 id="metrics">Metrics 
    <a href="#metrics" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<p>Metrics provide point-in-time snapshots of different measurements available to the application. These can be &ldquo;consumables&rdquo; (such as disk space, memory, cpu, file descriptors, etc&hellip;), or rates of events (such as requests in the last 15 seconds, or cache misses in the last minute, etc&hellip;).</p>
<p>By sampling these over time using a tool like Prometheus, you can give a really valuable insight into application health</p>
<h2 id="logging">Logging 
    <a href="#logging" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<p>Logs are a linear output of different points reached in your code. They can be useful for outputting system state at certain times.</p>
<p>It used to be popular to output different streams of logs to different files but with the short-term nature of application lifecycles, it&rsquo;s much better to output structured logging to <a href="https://www.howtogeek.com/435903/what-are-stdin-stdout-and-stderr-on-linux/">standard out and standard error</a> and let Kubernetes or Docker store it!</p>
<h2 id="tracing">Tracing 
    <a href="#tracing" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<p>Tracing is a comparatively new idea here. It allows you to see how a user action or event propagates through the entire system by allowing components to let each other know the parent span that originated the request.</p>
<p>Traces are built up of &ldquo;spans&rdquo; which can relate to each other in different ways. For example, you could have a parent span that tracks the duration of an event created from a button click which would track each of the requests made as child spans. Those child spans would then have their own child spans internal to the API (for example an auth middleware).</p>
<p>For example, for a simple three level architecture:</p>
<p><img src="/screenshots/span_example_arch.png" alt="Basic Three Level Architecture with External Auth"></p>
<p>We have some idea of the relationship between components but it might be hard to gauge relative load or diagnose where potential bottlenecks might be. With tracing we can find the relationships more quickly because you see a call stack like view:</p>
<p><img src="/screenshots/span_example.png" alt="Example Of Spans across Components"></p>
<p>Now we can see that each click might generate two database calls and a call to the external authentication provider. From my rough sketch, you might also assume that some of the potential slow down is actually in view layer since there&rsquo;s a lot of space on the right where there&rsquo;s nothing under &ldquo;Redraw Comment View&rdquo;.</p>
<p>The ability to pass context between components to get a full stack view of each call is very useful!</p>
<h1 id="review">Review 
    <a href="#review" class="heading-link"><i class="eos-icons">link</i></a>
</h1>
<h2 id="prior-knowledge-needed">Prior knowledge needed 
    <a href="#prior-knowledge-needed" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<ul>
<li>Programming in a supported modern language</li>
<li>Some way to run containers and access them (Docker, Podman, Kubernetes, etc)</li>
</ul>
<h2 id="sample-instrumentation">Sample Instrumentation 
    <a href="#sample-instrumentation" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<p>I apologize in advance that these instructions are comparatively long but there are several moving pieces that need to be in place first to make it all work.</p>
<h3 id="opentelemetry-collector">OpenTelemetry Collector 
    <a href="#opentelemetry-collector" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>I&rsquo;m actually going to skip using the collector for this example since it doesn&rsquo;t add anything to the understanding of the ideas being demonstrated. For any real world use, I would suggest looking into it!</p>
<p>I debated this for a while so if you feel like this is a mistake please let me know and I will adapt the example to use it.</p>
<h3 id="zipkin">Zipkin 
    <a href="#zipkin" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>I&rsquo;ll also install Zipkin over Jaeger because it&rsquo;s simpler. Jaeger does offer a lot more features and a better UI but for this example, I don&rsquo;t need the complexity.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d --name zipkin <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -p 9411:9411 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  openzipkin/zipkin
</code></pre></div><h3 id="prometheus">Prometheus 
    <a href="#prometheus" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>At the time of writing this, Prometheus seemed to be most popular choice for metrics collection (as well as being a CNCF Graduated project).</p>
<p>Prometheus can be installed by creating a configuration file called <code>prometheus.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">global</span>:
  <span style="color:#f92672">scrape_interval</span>: <span style="color:#ae81ff">15s</span>
  <span style="color:#f92672">scrape_timeout</span>: <span style="color:#ae81ff">10s</span>
  <span style="color:#f92672">evaluation_interval</span>: <span style="color:#ae81ff">15s</span>
<span style="color:#f92672">scrape_configs</span>:
- <span style="color:#f92672">job_name</span>: <span style="color:#ae81ff">prometheus</span>
  <span style="color:#f92672">honor_timestamps</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">scrape_interval</span>: <span style="color:#ae81ff">15s</span>
  <span style="color:#f92672">scrape_timeout</span>: <span style="color:#ae81ff">10s</span>
  <span style="color:#f92672">metrics_path</span>: <span style="color:#ae81ff">/metrics</span>
  <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">http</span>
  <span style="color:#f92672">static_configs</span>:
  - <span style="color:#f92672">targets</span>:
    - <span style="color:#ae81ff">localhost:9090</span>
- <span style="color:#f92672">job_name</span>: <span style="color:#ae81ff">my_sample_app</span>
  <span style="color:#f92672">honor_timestamps</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">scrape_interval</span>: <span style="color:#ae81ff">15s</span>
  <span style="color:#f92672">scrape_timeout</span>: <span style="color:#ae81ff">5s</span>
  <span style="color:#f92672">metrics_path</span>: <span style="color:#ae81ff">/metrics</span>
  <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">http</span>
  <span style="color:#f92672">static_configs</span>:
  - <span style="color:#f92672">targets</span>:
    - <span style="color:#ae81ff">localhost:3001</span>
</code></pre></div><p>This file will monitor itself and our non-yet-existing sample app.</p>
<p>We can then start the server with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -p 9090:9090  <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v <span style="color:#e6db74">`</span>pwd<span style="color:#e6db74">`</span>/prometheus.yml:/etc/prometheus/prometheus.yml <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  prom/prometheus
</code></pre></div><p>Browsing to <code>http://127.0.0.1:9090</code> will give me the Prometheus UI. We will come back to this once we have something worth monitoring!</p>
<h3 id="application-code">Application Code 
    <a href="#application-code" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>For this example, I&rsquo;ll set up a basic application express application that gets the weather for a provided address, &ldquo;caches&rdquo; it in sqlite, then returns the current temperature.</p>
<p>First, let&rsquo;s set up a new node project with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm init -y
npm i express axios sequelize sqlite3
</code></pre></div><p>Then write a sample application to <code>index.js</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">WEATHER_API_KEY</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Generate for free at https://home.openweathermap.org/`</span> 

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>)
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>()
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">axios</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;axios&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span>, <span style="color:#a6e22e">Model</span>, <span style="color:#a6e22e">DataTypes</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sequelize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Sequelize</span>(<span style="color:#e6db74">&#39;sqlite::memory:&#39;</span>)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Temp</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Model</span> {}
<span style="color:#a6e22e">Temp</span>.<span style="color:#a6e22e">init</span>({<span style="color:#a6e22e">temp</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>, <span style="color:#a6e22e">addr</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>}, {<span style="color:#a6e22e">sequelize</span>, <span style="color:#a6e22e">modelName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;temp&#39;</span>})
<span style="color:#a6e22e">sequelize</span>.<span style="color:#a6e22e">sync</span>()

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getTempsFromCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">addr</span>) =&gt; (<span style="color:#a6e22e">Temp</span>.<span style="color:#a6e22e">findAll</span>({<span style="color:#a6e22e">where</span><span style="color:#f92672">:</span>{<span style="color:#a6e22e">addr</span>}}))

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getTempFromAPIandCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">addr</span>) =&gt;{
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">`https://api.openweathermap.org/data/2.5/weather?q=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">addr</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;appid=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">WEATHER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Temp</span>.<span style="color:#a6e22e">create</span>({<span style="color:#a6e22e">temp</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">temp</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1.8</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">459.67</span>), <span style="color:#a6e22e">addr</span>}) <span style="color:#75715e">// convert K=&gt;F
</span><span style="color:#75715e"></span>}


<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/weather/:addresses&#39;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>)=&gt;{
  <span style="color:#66d9ef">try</span> {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">addresses</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;+&#39;</span>)

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ret</span> <span style="color:#f92672">=</span> []

    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>){
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">addr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">addresses</span>[<span style="color:#a6e22e">i</span>]
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">past</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getTempsFromCache</span>(<span style="color:#a6e22e">addr</span>)
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getTempFromAPIandCache</span>(<span style="color:#a6e22e">addr</span>)
      <span style="color:#a6e22e">ret</span>.<span style="color:#a6e22e">push</span>( {<span style="color:#a6e22e">addr</span>, <span style="color:#a6e22e">temps</span><span style="color:#f92672">:</span>[<span style="color:#a6e22e">current</span>, ...<span style="color:#a6e22e">past</span>].<span style="color:#a6e22e">map</span>(({<span style="color:#a6e22e">temp</span>})=&gt;(parseInt(<span style="color:#a6e22e">temp</span>)))})
    }

    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">ret</span>) 
  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>){ 
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">e</span>)
    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({<span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">e</span>}) 
  }
})

<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>)
</code></pre></div><p>You can test this by running</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">node index.js
</code></pre></div><p>Then browsing to <code>localhost:3000/weather/12345</code></p>
<p>Since I don&rsquo;t want to deal with babel set up, this is all the commonjs to have a <code>/weather/:address</code> endpoint that gets the weather for an address!</p>
<h3 id="tracing-auto-instrumentation">Tracing Auto Instrumentation 
    <a href="#tracing-auto-instrumentation" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>The installation of the client library will be language specific. For my use case I&rsquo;ll be using the <a href="https://github.com/open-telemetry/opentelemetry-js">node.js libraries</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm i @opentelemetry/core @opentelemetry/api @opentelemetry/tracing @opentelemetry/instrumentation @opentelemetry/node @opentelemetry/metrics @opentelemetry/exporter-prometheus @opentelemetry/exporter-zipkin @opentelemetry/plugin-http @opentelemetry/plugin-https @opentelemetry/plugin-express 
</code></pre></div><p>This loads all of the dependencies needed (as well as some that will auto-instrument requests for us!)</p>
<p>To wire up some basic tracing, we can create a file called <code>tracer.js</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span>  <span style="color:#a6e22e">opentelemetry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/api&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">NodeTracerProvider</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/node&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">SimpleSpanProcessor</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/tracing&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">ZipkinExporter</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/exporter-zipkin&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">registerInstrumentations</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@opentelemetry/instrumentation&#34;</span>)
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">provider</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NodeTracerProvider</span>({})

<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">addSpanProcessor</span>(
  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SimpleSpanProcessor</span>(
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ZipkinExporter</span>({<span style="color:#a6e22e">serviceName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;my-sample-app&#39;</span>})
  )
)

<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">register</span>()
<span style="color:#a6e22e">registerInstrumentations</span>({
  <span style="color:#a6e22e">tracerProvider</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">provider</span>,
})

<span style="color:#a6e22e">opentelemetry</span>.<span style="color:#a6e22e">trace</span>.<span style="color:#a6e22e">setGlobalTracerProvider</span>(<span style="color:#a6e22e">provider</span>)
</code></pre></div><p>Then we can run the application with the <code>-r</code> flag to use this new file as a global requirement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">node -r tracer.js index.js
</code></pre></div><p>Now, we can run a few queries against this app:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://127.0.0.1:3000/weather/10001+90058+75201+98101+80201
</code></pre></div><p>Then browse to <code>http://127.0.0.1:9411/zipkin/</code> and click <code>RUN QUERY</code> (at the top right). This should show the recent span generated by this request.</p>
<p>If you click on <code>SHOW</code>, it&rsquo;ll give you a view of the &ldquo;span-tree&rdquo; generated:</p>
<p><img src="/screenshots/trace_bad.png" alt="Trace with multiple sequential calls"></p>
<p>If we look at this, we see some inefficiency in the code we wrote very clearly since the requests are happening sequentially.</p>
<p>Let&rsquo;s quickly refactor this code and replace the for loop with some async and promise magic:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ret</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> Promise.<span style="color:#a6e22e">all</span>(<span style="color:#a6e22e">addresses</span>.<span style="color:#a6e22e">map</span>( <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">addr</span>)=&gt;{
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">past</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getTempsFromCache</span>(<span style="color:#a6e22e">addr</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getTempFromAPIandCache</span>(<span style="color:#a6e22e">addr</span>)
  <span style="color:#66d9ef">return</span> {<span style="color:#a6e22e">addr</span>, <span style="color:#a6e22e">temps</span><span style="color:#f92672">:</span>[<span style="color:#a6e22e">current</span>, ...<span style="color:#a6e22e">past</span>].<span style="color:#a6e22e">map</span>(({<span style="color:#a6e22e">temp</span>})=&gt;(parseInt(<span style="color:#a6e22e">temp</span>)))}
}))
</code></pre></div><p>This will run the requests in parallel then return all the same data as before. To see this, run the same test as before:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://127.0.0.1:3000/weather/10001+90058+75201+98101+80201
</code></pre></div><p>And then click <code>RUN QUERY</code> and <code>SHOW</code> on the new trace. You should now see that the requests were performed in parallel!</p>
<p><img src="/screenshots/trace_good.png" alt="Trace with multiple parallel calls"></p>
<h3 id="metrics-collection">Metrics Collection 
    <a href="#metrics-collection" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>Next let&rsquo;s set up a metrics exporter for api requests and temperatures requested.</p>
<p>We can do this by adding the following code at the top of index.js:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">MeterProvider</span> }  <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/metrics&#39;</span>)
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">PrometheusExporter</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@opentelemetry/exporter-prometheus&#39;</span>)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">exporter</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PrometheusExporter</span>({ <span style="color:#a6e22e">startServer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3001</span> })
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">meter</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MeterProvider</span>({<span style="color:#a6e22e">exporter</span>, <span style="color:#a6e22e">interval</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span>}).<span style="color:#a6e22e">getMeter</span>(<span style="color:#e6db74">&#39;example-prometheus&#39;</span>)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requestCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">meter</span>.<span style="color:#a6e22e">createCounter</span>(<span style="color:#e6db74">&#34;request_count&#34;</span>)
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tempsRequested</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">meter</span>.<span style="color:#a6e22e">createCounter</span>(<span style="color:#e6db74">&#34;temp_req_count&#34;</span>)
</code></pre></div><p>We can then add:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>,<span style="color:#a6e22e">res</span>,<span style="color:#a6e22e">next</span>)=&gt;{<span style="color:#a6e22e">requestCount</span>.<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">1</span>); <span style="color:#a6e22e">next</span>()})
</code></pre></div><p>above <code>app.get(...)</code> to count all of the requests.</p>
<p>We can also change <code>getTempFromAPIandCache</code> to be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getTempFromAPIandCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">addr</span>) =&gt;{
  <span style="color:#a6e22e">tempsRequested</span>.<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">1</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">`https://api.openweathermap.org/data/2.5/weather?q=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">addr</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;appid=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">WEATHER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)  
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Temp</span>.<span style="color:#a6e22e">create</span>({<span style="color:#a6e22e">temp</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">temp</span>, <span style="color:#a6e22e">addr</span>})
}
</code></pre></div><p>This will count all of the times we request a temp from <code>openweathermap.org</code>.</p>
<p>Once you call the API a few times, browse to <code>http://127.0.0.1:9090</code> and input the expression:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-promql" data-lang="promql">request_count
</code></pre></div><p>This will show you how many times the api had been called the last time prometheus queried the metrics. This timing is controlled by the configuration yaml we wrote while installing prometheus.</p>
<p>We can do the same with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-promql" data-lang="promql">temp_req_count
</code></pre></div><h3 id="logging-1">Logging 
    <a href="#logging-1" class="heading-link"><i class="eos-icons">link</i></a>
</h3>
<p>At the time of my writing this, the logging portion of OpenTelemtry was not finished yet. There are several drafts of how this would be done and it looks really good in my opinion! I&rsquo;ll update this to include logging as soon as I hear that there are libraries published to leverage.</p>
<h2 id="pros">Pros 
    <a href="#pros" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<ul>
<li>Open standards with the implementations and market buy-in to succeed</li>
<li>Auto-instrumentation is awesome!</li>
<li>Large base of supported languages</li>
</ul>
<h2 id="cons">Cons 
    <a href="#cons" class="heading-link"><i class="eos-icons">link</i></a>
</h2>
<ul>
<li>Requires code additions to gain most value</li>
<li>A bit new so some libraries are still in flux</li>
</ul>
<h1 id="conclusion">Conclusion 
    <a href="#conclusion" class="heading-link"><i class="eos-icons">link</i></a>
</h1>
<p>OpenTelemetry has enough other projects backing it that I don&rsquo;t see it going away. It solves a very real need and can make debugging problems after they happen in production possible again without needing to build crazy systems of quarantining pods that are acting up.</p>
<p>Done right, it can also be a good way to bridge the gap between the developer and operator by giving a common touch point for both teams. Developers want good feedback when something goes wrong in production and operators want early warning before those things go wrong.</p>
<p>If you are building an application in a cloud native way, you should be instrumenting your code. OpenTelemetry gives an easy way to go about that!</p>
</section>

        </div>
    </section>
    <footer class="footer-content js-footer-content"><ul class="footer-list">
    <li class="footer-list-item"><a class="footer-link" href="/cookies-policy" data-event-category="Internal link" data-event-action="Cookies policy" data-event-label="Footer">Cookie policy</a></li>
    <li class="footer-list-item"><a class="footer-link" href="https://eosdesignsystem.com/" data-event-category="External link" data-event-action="Link EOS website" data-event-label="Footer" target="_blank" rel="noreferrer nonopener"><img class="js-tooltip" src="images/eos-logo.svg" data-toggle="tooltip" data-html="true" title="Visit our website" alt="EOS icon"></a></li>
</ul></footer>
  </body>
</html>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="/js/index.js"></script>
<script src="/js/main.js"></script>
